<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediSafe - Smart Health Tracking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@7.8.1/build/index.min.js"></script>
    <style>
        :root {
            --primary: #2563EB;
            --primary-dark: #1E40AF;
            --accent: #10B981;
            --accent-dark: #059669;
            --danger: #EF4444;
            --warning: #F59E0B;
            --success: #10B981;
            --gray-50: #F9FAFB;
            --gray-100: #F3F4F6;
            --gray-200: #E5E7EB;
            --gray-300: #D1D5DB;
            --gray-500: #6B7280;
            --gray-600: #4B5563;
            --gray-700: #374151;
            --gray-900: #111827;
            --white: #FFFFFF;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--gray-50);
            color: var(--gray-900);
            line-height: 1.6;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background-color: var(--white);
            min-height: 100vh;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow-x: hidden;
        }

        /* Screen Management */
        .screen {
            display: none;
            min-height: 100vh;
        }
        
        .screen.active {
            display: block;
        }

        /* Login Screen Styles */
        #loginScreen {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
        }

        .login-header {
            padding: 60px 30px 30px;
            text-align: center;
        }

        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-weight: 700;
            font-size: 2.2rem;
            margin-bottom: 15px;
        }

        .login-logo i {
            font-size: 2.8rem;
        }

        .login-tagline {
            opacity: 0.9;
            font-size: 1.1rem;
            margin-bottom: 10px;
        }

        .login-form-container {
            background: var(--white);
            border-radius: 30px 30px 0 0;
            padding: 40px 30px;
            color: var(--gray-900);
            min-height: calc(100vh - 200px);
        }

        .form-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--gray-200);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .forgot-password {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .login-button {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .login-button:hover {
            background: var(--primary-dark);
        }

        .signup-prompt {
            text-align: center;
            margin-top: 20px;
            color: var(--gray-500);
        }

        .signup-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .language-selector {
            text-align: center;
            margin-top: 20px;
        }

        .language-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .lang-btn {
            padding: 8px 16px;
            background: var(--gray-100);
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .lang-btn.active {
            background: var(--primary);
            color: var(--white);
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 20px 16px;
            border-radius: 0 0 20px 20px;
            position: relative;
            overflow: hidden;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .language-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--white);
            padding: 8px 16px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .language-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .user-greeting {
            margin-bottom: 20px;
        }

        .user-greeting h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .user-greeting p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .stats-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Main Content Styles */
        main {
            padding: 20px 16px;
            padding-bottom: 80px; /* Space for bottom nav */
        }

        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title h2 {
            font-size: 1.2rem;
            color: var(--gray-900);
        }

        .see-all {
            color: var(--primary);
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
        }

        /* Medication Cards */
        .medication-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            transition: var(--transition);
        }

        .medication-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .medication-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .medication-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--gray-900);
        }

        .medication-dosage {
            color: var(--gray-500);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .medication-time {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--primary);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .medication-actions {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }

        .btn {
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background-color: var(--gray-200);
        }

        .btn-success {
            background-color: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background-color: var(--accent-dark);
        }

        /* Appointment Cards */
        .appointment-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--accent);
            transition: var(--transition);
        }

        .appointment-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .appointment-doctor {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--gray-900);
        }

        .appointment-specialization {
            color: var(--primary);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .appointment-date {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--gray-700);
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .appointment-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-upcoming {
            background-color: #FEF3C7;
            color: #92400E;
        }

        .status-completed {
            background-color: #DCFCE7;
            color: #166534;
        }

        /* Health Metrics */
        .metrics-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin: 10px 0;
        }

        .metric-label {
            color: var(--gray-500);
            font-size: 0.9rem;
        }

        .metric-trend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .trend-up {
            color: var(--success);
        }

        .trend-down {
            color: var(--danger);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 480px;
            margin: 0 auto;
            background: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray-500);
            transition: var(--transition);
            flex: 1;
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* AI Assistant */
        .ai-assistant {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 99;
            transition: var(--transition);
            animation: pulse 2s infinite;
        }

        .ai-assistant:hover {
            transform: scale(1.1);
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(37, 99, 235, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(37, 99, 235, 0);
            }
        }

        /* Sound Control */
        .sound-control {
            position: fixed;
            bottom: 150px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.2rem;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 98;
            transition: var(--transition);
        }

        .sound-control:hover {
            transform: scale(1.1);
        }

        .sound-control.muted {
            background: linear-gradient(135deg, var(--gray-500), var(--gray-700));
        }

        /* Accessibility Features */
        .accessibility-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            box-shadow: var(--shadow-lg);
            z-index: 101;
            display: none;
        }

        .accessibility-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--primary);
            color: var(--white);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .text-size-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .text-size-btn {
            padding: 8px 12px;
            background: var(--gray-100);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .text-size-btn.active {
            background: var(--primary);
            color: var(--white);
        }

        .high-contrast-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-300);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Kannada Language Support */
        .kannada {
            display: none;
        }

        /* Profile Screen Styles */
        .profile-header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 0 0 20px 20px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 2.5rem;
        }

        .profile-info {
            padding: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .info-label {
            font-weight: 600;
            color: var(--gray-700);
        }

        .info-value {
            color: var(--gray-500);
        }
        
        /* Medications Screen Styles */
        .medication-list {
            margin-top: 20px;
        }

        .add-medication {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 99;
            transition: var(--transition);
        }

        /* Appointments Screen Styles */
        .appointment-list {
            margin-top: 20px;
        }

        .add-appointment {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            z-index: 99;
            transition: var(--transition);
        }

        .appointment-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--gray-200);
        }

        .detail-row {
            display: flex;
            margin-bottom: 8px;
        }

        .detail-label {
            font-weight: 600;
            color: var(--gray-700);
            min-width: 120px;
        }

        .detail-value {
            color: var(--gray-500);
        }

        /* Health Screen Styles */
        .health-stats {
            margin-top: 20px;
        }

        .health-chart {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-container {
            width: 100%;
            height: 250px;
            margin: 20px 0;
            position: relative;
        }

        .chart-placeholder {
            height: 200px;
            background: var(--gray-100);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-500);
            flex-direction: column;
        }

        /* Back Button */
        .back-button {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 8px;
            border-radius: 8px;
            transition: var(--transition);
        }

        .back-button:hover {
            background-color: var(--gray-100);
        }

        /* Notification Styles */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 350px;
        }

        .notification {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.3s ease;
            border-left: 4px solid var(--warning);
        }

        .notification-success {
            border-left-color: var(--success);
        }

        .notification-info {
            border-left-color: var(--primary);
        }

        .notification-icon {
            font-size: 1.5rem;
            color: var(--warning);
        }

        .notification-success .notification-icon {
            color: var(--success);
        }

        .notification-info .notification-icon {
            color: var(--primary);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--gray-900);
        }

        .notification-message {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* AI Chat Modal */
        .ai-chat-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .ai-chat-modal.active {
            display: flex;
        }

        .ai-chat-container {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
        }

        .ai-chat-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-chat-body {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }

        .ai-message {
            background: var(--gray-100);
            padding: 10px 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            max-width: 80%;
        }

        .user-message {
            background: var(--primary);
            color: white;
            margin-left: auto;
            text-align: right;
        }

        .ai-chat-input {
            padding: 15px;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 10px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--gray-300);
            border-radius: 20px;
            outline: none;
        }

        .ai-chat-input button {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
        }

        /* Medicine Instructions */
        .medicine-instructions {
            background: #FFF3CD;
            border: 1px solid #FFECB5;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .instructions-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Sound Test Panel */
        .sound-test-panel {
            position: fixed;
            bottom: 210px;
            right: 20px;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 97;
            display: none;
            width: 200px;
        }

        .sound-test-panel.active {
            display: block;
        }

        .sound-test-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--gray-900);
        }

        .sound-test-btn {
            width: 100%;
            padding: 8px;
            margin-bottom: 5px;
            background: var(--gray-100);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .sound-test-btn:hover {
            background: var(--gray-200);
        }

        .sound-test-btn.reminder {
            background: var(--warning);
            color: white;
        }

        .sound-test-btn.emergency {
            background: var(--danger);
            color: white;
        }

        .sound-test-btn.success {
            background: var(--success);
            color: white;
        }

        /* Enable Sound Button */
        .enable-sound-btn {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: var(--border-radius);
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .enable-sound-btn:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        /* Chart Styles */
        #bpChart {
            width: 100% !important;
            height: 250px !important;
        }
        
        .chart-placeholder {
            width: 100%;
            height: 250px;
            background: var(--gray-50);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border: 2px dashed var(--gray-200);
        }
        
        .chart-placeholder i {
            font-size: 3rem;
            color: var(--gray-300);
            margin-bottom: 15px;
        }
        
        .chart-placeholder span {
            color: var(--gray-500);
            text-align: center;
            max-width: 80%;
            margin: 0 auto;
        }
        
        .chart-placeholder button {
            margin-top: 15px;
            padding: 8px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }
        
        .chart-placeholder button:hover {
            background: var(--primary-dark);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-header h3 {
            color: var(--gray-900);
            margin-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--gray-700);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        .modal-actions button {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }
        
        .modal-cancel {
            background: var(--gray-100);
            color: var(--gray-700);
        }
        
        .modal-confirm {
            background: var(--primary);
            color: white;
        }
        
        /* Text size classes */
        body.large {
            font-size: 1.2rem;
        }
        
        body.x-large {
            font-size: 1.4rem;
        }
        
        body.high-contrast {
            --primary: #000000;
            --primary-dark: #000000;
            --accent: #000000;
            --accent-dark: #000000;
            --danger: #000000;
            --warning: #000000;
            --success: #000000;
            --gray-50: #FFFFFF;
            --gray-100: #F0F0F0;
            --gray-200: #DDDDDD;
            --gray-300: #CCCCCC;
            --gray-500: #666666;
            --gray-700: #333333;
            --gray-900: #000000;
            --white: #FFFFFF;
        }
        
        /* Call Simulation */
        .call-simulation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
        }
        
        .call-content {
            text-align: center;
            padding: 30px;
            background: var(--gray-900);
            border-radius: var(--border-radius);
            max-width: 300px;
            width: 90%;
        }
        
        .call-content h3 {
            margin-bottom: 20px;
            color: white;
        }
        
        .call-number {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: white;
        }
        
        .call-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
        }
        
        .call-end {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .call-mute {
            background: var(--gray-600);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Enable Sound Button -->
    <button class="enable-sound-btn" id="enableSoundBtn">
        <i class="fas fa-volume-up"></i>
        <span>Click to Enable Sounds</span>
    </button>

    <div class="container">
        <!-- Audio Elements for Sounds -->
        <audio id="medicationSound" preload="auto">
            <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
        </audio>
        <audio id="appointmentSound" preload="auto">
            <source src="https://assets.mixkit.co/sfx/preview/mixkit-clear-announce-tones-2861.mp3" type="audio/mpeg">
        </audio>
        <audio id="emergencySound" preload="auto">
            <source src="https://assets.mixkit.co/sfx/preview/mixkit-warning-alarm-buzzer-2852.mp3" type="audio/mpeg">
        </audio>
        <audio id="successSound" preload="auto">
            <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
        </audio>
        <audio id="deepAlertSound" preload="auto">
            <source src="https://assets.mixkit.co/sfx/preview/mixkit-deep-urgent-alarm-1005.mp3" type="audio/mpeg">
        </audio>
        
        <!-- Notification Container -->
        <div class="notification-container" id="notificationContainer"></div>

        <!-- AI Chat Modal -->
        <div class="ai-chat-modal" id="aiChatModal">
            <div class="ai-chat-container">
                <div class="ai-chat-header">
                    <div>
                        <h3><i class="fas fa-robot"></i> MediSafe AI Assistant</h3>
                        <p>How can I help you today?</p>
                    </div>
                    <button class="ai-chat-close" id="aiChatClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="ai-chat-body" id="aiChatBody">
                    <div class="ai-message">
                        Hello! I'm your MediSafe AI Assistant. I can help you with:
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            <li>Medication reminders</li>
                            <li>Appointment scheduling</li>
                            <li>Health tips</li>
                            <li>Emergency contacts</li>
                        </ul>
                        How can I assist you today?
                    </div>
                </div>
                <div class="ai-chat-input">
                    <input type="text" id="aiChatInput" placeholder="Type your message...">
                    <button id="aiChatSend">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sound Test Panel -->
        <div class="sound-test-panel" id="soundTestPanel">
            <div class="sound-test-title">Test Sounds</div>
            <button class="sound-test-btn reminder" id="testReminderSound">
                <i class="fas fa-bell"></i> Medication Reminder
            </button>
            <button class="sound-test-btn emergency" id="testEmergencySound">
                <i class="fas fa-exclamation-triangle"></i> Emergency Alert
            </button>
            <button class="sound-test-btn success" id="testSuccessSound">
                <i class="fas fa-check-circle"></i> Success Sound
            </button>
            <button class="sound-test-btn" id="testDeepSound">
                <i class="fas fa-volume-up"></i> Deep Alert
            </button>
            <button class="sound-test-btn" id="testBeepSound">
                <i class="fas fa-bell"></i> Simple Beep
            </button>
        </div>

        <!-- Login Screen -->
        <div class="screen active" id="loginScreen">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-heartbeat"></i>
                    <span class="english">MediSafe</span>
                    <span class="kannada">ಮೆಡಿಸೇಫ್</span>
                </div>
                <p class="login-tagline english">Your Smart Health Companion</p>
                <p class="login-tagline kannada">ನಿಮ್ಮ ಸ್ಮಾರ್ಟ್ ಆರೋಗ್ಯ ಸಂಗಾತಿ</p>
            </div>

            <div class="login-form-container">
                <h2 class="form-title english">Welcome Back</h2>
                <h2 class="form-title kannada">ಸುಸ್ವಾಗತ</h2>

                <div class="input-group">
                    <label class="input-label english" for="email">Email Address</label>
                    <label class="input-label kannada" for="email">ಇಮೇಲ್ ವಿಳಾಸ</label>
                    <input type="email" id="email" class="input-field" placeholder="your.email@example.com">
                </div>

                <div class="input-group">
                    <label class="input-label english" for="password">Password</label>
                    <label class="input-label kannada" for="password">ಪಾಸ್ವರ್ಡ್</label>
                    <input type="password" id="password" class="input-field" placeholder="Enter your password">
                </div>

                <div class="login-options">
                    <div class="remember-me">
                        <input type="checkbox" id="remember">
                        <label for="remember" class="english">Remember me</label>
                        <label for="remember" class="kannada">ನನ್ನನ್ನು ನೆನಪಿಡಿ</label>
                    </div>
                    <a href="#" class="forgot-password english">Forgot Password?</a>
                    <a href="#" class="forgot-password kannada">ಪಾಸ್ವರ್ಡ್ ಮರೆತಿರಾ?</a>
                </div>

                <button class="login-button" id="loginButton">
                    <span class="english">Sign In</span>
                    <span class="kannada">ಸೈನ್ ಇನ್</span>
                </button>

                <div class="signup-prompt">
                    <span class="english">Don't have an account? </span>
                    <span class="kannada">ಖಾತೆ ಇಲ್ಲವೇ? </span>
                    <a href="#" class="signup-link english">Sign Up</a>
                    <a href="#" class="signup-link kannada">ಸೈನ್ ಅಪ್</a>
                </div>

                <div class="language-selector">
                    <div class="language-buttons">
                        <button class="lang-btn active" data-lang="en">English</button>
                        <button class="lang-btn" data-lang="kn">ಕನ್ನಡ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main App -->
        <div class="screen" id="mainApp">
            <!-- Sound Control -->
            <div class="sound-control" id="soundControl">
                <i class="fas fa-volume-up"></i>
            </div>

            <!-- Accessibility Toggle -->
            <div class="accessibility-toggle" id="accessibilityToggle">
                <i class="fas fa-universal-access"></i>
            </div>

            <!-- Accessibility Panel -->
            <div class="accessibility-panel" id="accessibilityPanel">
                <h3>Accessibility Settings</h3>
                <div class="text-size-options">
                    <button class="text-size-btn active" data-size="medium">A</button>
                    <button class="text-size-btn" data-size="large">A+</button>
                    <button class="text-size-btn" data-size="x-large">A++</button>
                </div>
                <div class="high-contrast-toggle">
                    <span>High Contrast</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="highContrastToggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <button class="btn btn-primary" id="closeAccessibility">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>

            <!-- Home Screen -->
            <div class="screen active" id="homeScreen">
                <header>
                    <div class="header-top">
                        <div class="logo">
                            <i class="fas fa-heartbeat"></i>
                            <span class="english">MediSafe</span>
                            <span class="kannada">ಮೆಡಿಸೇಫ್</span>
                        </div>
                        <button class="language-toggle" id="languageToggle">
                            <i class="fas fa-globe"></i>
                            <span class="english">Kannada</span>
                            <span class="kannada">English</span>
                        </button>
                    </div>

                    <div class="user-greeting">
                        <h1 class="english">Good Morning, John!</h1>
                        <h1 class="kannada">ಶುಭೋದಯ, ಜಾನ್!</h1>
                        <p class="english">Here's your health summary for today</p>
                        <p class="kannada">ಇಂದಿನ ನಿಮ್ಮ ಆರೋಗ್ಯ ಸಾರಾಂಶ ಇಲ್ಲಿದೆ</p>
                    </div>

                    <div class="stats-container">
                        <div class="stat-item">
                            <div class="stat-value">3</div>
                            <div class="stat-label english">Medications</div>
                            <div class="stat-label kannada">ಔಷಧಿಗಳು</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">2</div>
                            <div class="stat-label english">Appointments</div>
                            <div class="stat-label kannada">ನಿಯಮಿತಗಳು</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">98</div>
                            <div class="stat-label english">Blood Sugar</div>
                            <div class="stat-label kannada">ರಕ್ತದ ಸಕ್ಕರೆ</div>
                        </div>
                    </div>
                </header>

                <main>
                    <!-- Today's Medications Section -->
                    <div class="section-title">
                        <h2 class="english">Today's Medications</h2>
                        <h2 class="kannada">ಇಂದಿನ ಔಷಧಿಗಳು</h2>
                        <a href="#" class="see-all english">See All</a>
                        <a href="#" class="see-all kannada">ಎಲ್ಲಾ ನೋಡಿ</a>
                    </div>

                    <div class="medication-card">
                        <div class="medication-header">
                            <div>
                                <div class="medication-name">Metformin 500mg</div>
                                <div class="medication-dosage english">1 tablet after food</div>
                                <div class="medication-dosage kannada">ಊಟದ ನಂತರ 1 ಮಾತ್ರೆ</div>
                            </div>
                            <div class="medication-time">
                                <i class="far fa-clock"></i>
                                <span>8:00 AM</span>
                            </div>
                        </div>
                        <div class="medicine-instructions">
                            <div class="instructions-title">
                                <i class="fas fa-info-circle"></i>
                                <span class="english">Take 10-15 minutes after meal</span>
                                <span class="kannada">ಊಟದ 10-15 ನಿಮಿಷಗಳ ನಂತರ ತೆಗೆದುಕೊಳ್ಳಿ</span>
                            </div>
                        </div>
                        <div class="medication-actions">
                            <button class="btn btn-success" data-medication="Metformin 500mg">
                                <i class="fas fa-check"></i>
                                <span class="english">Taken</span>
                                <span class="kannada">ತೆಗೆದುಕೊಂಡಿದೆ</span>
                            </button>
                            <button class="btn btn-secondary">
                                <i class="fas fa-clock"></i>
                                <span class="english">Snooze</span>
                                <span class="kannada">ಮುಂದೂಡು</span>
                            </button>
                        </div>
                    </div>

                    <!-- Upcoming Appointments -->
                    <div class="section-title">
                        <h2 class="english">Upcoming Appointments</h2>
                        <h2 class="kannada">ಮುಂಬರುವ ನಿಯಮಿತಗಳು</h2>
                        <a href="#" class="see-all english">See All</a>
                        <a href="#" class="see-all kannada">ಎಲ್ಲಾ ನೋಡಿ</a>
                    </div>

                    <div class="appointment-card">
                        <div class="appointment-header">
                            <div>
                                <div class="appointment-doctor">Dr. Anjali Sharma</div>
                                <div class="appointment-specialization">Cardiologist</div>
                            </div>
                            <div>
                                <span class="appointment-status status-upcoming">Upcoming</span>
                            </div>
                        </div>
                        <div class="appointment-date">
                            <i class="far fa-calendar"></i>
                            <span>Today, 10:30 AM</span>
                        </div>
                        <div class="appointment-actions">
                            <button class="btn btn-primary view-report-btn">
                                <i class="fas fa-calendar-check"></i>
                                <span class="english">View Details</span>
                                <span class="kannada">ವಿವರಗಳು ನೋಡಿ</span>
                            </button>
                            <button class="btn btn-secondary call-clinic-btn">
                                <i class="fas fa-phone"></i>
                                <span class="english">Call</span>
                                <span class="kannada">ಕರೆ ಮಾಡಿ</span>
                            </button>
                        </div>
                    </div>

                    <!-- Health Metrics -->
                    <div class="section-title">
                        <h2 class="english">Health Metrics</h2>
                        <h2 class="kannada">ಆರೋಗ್ಯ ಮೆಟ್ರಿಕ್ಸ್</h2>
                        <a href="#" class="see-all english">See History</a>
                        <a href="#" class="see-all kannada">ಇತಿಹಾಸ ನೋಡಿ</a>
                    </div>

                    <div class="metrics-container">
                        <div class="metric-card">
                            <div class="metric-label english">Blood Pressure</div>
                            <div class="metric-label kannada">ರಕ್ತದೊತ್ತಡ</div>
                            <div class="metric-value">122/80</div>
                            <div class="metric-trend trend-down">
                                <i class="fas fa-arrow-down"></i>
                                <span>2% from last week</span>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label english">Weight</div>
                            <div class="metric-label kannada">ತೂಕ</div>
                            <div class="metric-value">72<span style="font-size: 1rem;">kg</span></div>
                            <div class="metric-trend trend-down">
                                <i class="fas fa-arrow-down"></i>
                                <span>1kg from last month</span>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Medications Screen -->
            <div class="screen" id="medicationsScreen">
                <header>
                    <div class="header-top">
                        <button class="back-button" id="backToHomeFromMeds">
                            <i class="fas fa-arrow-left"></i>
                            <span class="english">Back to Home</span>
                            <span class="kannada">ಮುಖಪುಟಕ್ಕೆ ಹಿಂದಿರುಗಿ</span>
                        </button>
                        <div class="logo">
                            <i class="fas fa-pills"></i>
                            <span class="english">Medications</span>
                            <span class="kannada">ಔಷಧಿಗಳು</span>
                        </div>
                        <button class="language-toggle">
                            <i class="fas fa-globe"></i>
                            <span class="english">Kannada</span>
                            <span class="kannada">English</span>
                        </button>
                    </div>
                </header>

                <main>
                    <div class="section-title">
                        <h2 class="english">Your Medications</h2>
                        <h2 class="kannada">ನಿಮ್ಮ ಔಷಧಿಗಳು</h2>
                    </div>

                    <div class="medication-list">
                        <!-- Medication cards will be populated here -->
                    </div>

                    <div class="add-medication" id="addMedication">
                        <i class="fas fa-plus"></i>
                    </div>
                </main>
            </div>

            <!-- Appointments Screen -->
            <div class="screen" id="appointmentsScreen">
                <header>
                    <div class="header-top">
                        <button class="back-button" id="backToHomeFromAppointments">
                            <i class="fas fa-arrow-left"></i>
                            <span class="english">Back to Home</span>
                            <span class="kannada">ಮುಖಪುಟಕ್ಕೆ ಹಿಂದಿರುಗಿ</span>
                        </button>
                        <div class="logo">
                            <i class="fas fa-calendar-check"></i>
                            <span class="english">Appointments</span>
                            <span class="kannada">ನಿಯಮಿತಗಳು</span>
                        </div>
                        <button class="language-toggle">
                            <i class="fas fa-globe"></i>
                            <span class="english">Kannada</span>
                            <span class="kannada">English</span>
                        </button>
                    </div>
                </header>

                <main>
                    <div class="section-title">
                        <h2 class="english">Your Appointments</h2>
                        <h2 class="kannada">ನಿಮ್ಮ ನಿಯಮಿತಗಳು</h2>
                    </div>

                    <div class="appointment-list">
                        <!-- Appointments will be populated here -->
                    </div>

                    <div class="add-appointment" id="addAppointment">
                        <i class="fas fa-plus"></i>
                    </div>
                </main>
            </div>

            <!-- Health Screen -->
            <div class="screen" id="healthScreen">
                <header>
                    <div class="header-top">
                        <button class="back-button" id="backToHomeFromHealth">
                            <i class="fas fa-arrow-left"></i>
                            <span class="english">Back to Home</span>
                            <span class="kannada">ಮುಖಪುಟಕ್ಕೆ ಹಿಂದಿರುಗಿ</span>
                        </button>
                        <div class="logo">
                            <i class="fas fa-heartbeat"></i>
                            <span class="english">Health</span>
                            <span class="kannada">ಆರೋಗ್ಯ</span>
                        </div>
                        <button class="language-toggle">
                            <i class="fas fa-globe"></i>
                            <span class="english">Kannada</span>
                            <span class="kannada">English</span>
                        </button>
                    </div>
                </header>

                <main>
                    <div class="health-stats">
                        <div class="section-title">
                            <h2 class="english">Health Overview</h2>
                            <h2 class="kannada">ಆರೋಗ್ಯ ಅವಲೋಕನ</h2>
                        </div>

                        <div class="metrics-container">
                            <div class="metric-card">
                                <div class="metric-label english">Blood Pressure</div>
                                <div class="metric-label kannada">ರಕ್ತದೊತ್ತಡ</div>
                                <div class="metric-value">122/80</div>
                                <div class="metric-trend trend-down">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>2% from last week</span>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label english">Weight</div>
                                <div class="metric-label kannada">ತೂಕ</div>
                                <div class="metric-value">72<span style="font-size: 1rem;">kg</span></div>
                                <div class="metric-trend trend-down">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>1kg from last month</span>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label english">Blood Sugar</div>
                                <div class="metric-label kannada">ರಕ್ತದ ಸಕ್ಕರೆ</div>
                                <div class="metric-value">98</div>
                                <div class="metric-trend trend-down">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>5% from last week</span>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-label english">Heart Rate</div>
                                <div class="metric-label kannada">ಹೃದಯ ಬಡಿತ</div>
                                <div class="metric-value">72</div>
                                <div class="metric-trend trend-down">
                                    <i class="fas fa-arrow-down"></i>
                                    <span>3% from last week</span>
                                </div>
                            </div>
                        </div>

                        <div class="section-title">
                            <h2 class="english">Blood Pressure Trend</h2>
                            <h2 class="kannada">ರಕ್ತದೊತ್ತಡದ ಪ್ರವೃತ್ತಿ</h2>
                        </div>

                        <div class="health-chart">
                            <div class="chart-container">
                                <canvas id="bpChart"></canvas>
                            </div>
                            <div class="chart-placeholder" id="chartPlaceholder">
                                <i class="fas fa-chart-line"></i>
                                <span class="english">Loading blood pressure chart...</span>
                                <span class="kannada">ರಕ್ತದೊತ್ತಡದ ಚಾರ್ಟ್ ಲೋಡ್ ಆಗುತ್ತಿದೆ...</span>
                            </div>
                        </div>

                        <div class="section-title">
                            <h2 class="english">Recent Measurements</h2>
                            <h2 class="kannada">ಇತ್ತೀಚಿನ ಮಾಪನಗಳು</h2>
                        </div>

                        <div class="medication-card">
                            <div class="medication-header">
                                <div>
                                    <div class="medication-name english">Blood Pressure</div>
                                    <div class="medication-name kannada">ರಕ್ತದೊತ್ತಡ</div>
                                    <div class="medication-dosage">122/80 mmHg</div>
                                </div>
                                <div class="medication-time">
                                    <span>Today, 8:00 AM</span>
                                </div>
                            </div>
                        </div>

                        <div class="medication-card">
                            <div class="medication-header">
                                <div>
                                    <div class="medication-name english">Weight</div>
                                    <div class="medication-name kannada">ತೂಕ</div>
                                    <div class="medication-dosage">72 kg</div>
                                </div>
                                <div class="medication-time">
                                    <span>Yesterday, 7:00 AM</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- Profile Screen -->
            <div class="screen" id="profileScreen">
                <header class="profile-header">
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <h1 class="english">John Doe</h1>
                    <h1 class="kannada">ಜಾನ್ ಡೋ</h1>
                    <p class="english">Age: 65 | Diabetes, Hypertension</p>
                    <p class="kannada">ವಯಸ್ಸು: 65 | ಮಧುಮೇಹ, ಅಧಿಕ ರಕ್ತದೊತ್ತಡ</p>
                </header>

                <main>
                    <div class="profile-info">
                        <div class="info-item">
                            <span class="info-label english">Email</span>
                            <span class="info-label kannada">ಇಮೇಲ್</span>
                            <span class="info-value">john.doe@example.com</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label english">Phone</span>
                            <span class="info-label kannada">ಫೋನ್</span>
                            <span class="info-value">+91 98765 43210</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label english">Emergency Contact</span>
                            <span class="info-label kannada">ಅತ್ಯಾವಶ್ಯಕ ಸಂಪರ್ಕ</span>
                            <span class="info-value">Jane Doe (+91 98765 43211)</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label english">Medical Conditions</span>
                            <span class="info-label kannada">ವೈದ್ಯಕೀಯ ಸ್ಥಿತಿಗಳು</span>
                            <span class="info-value">Diabetes, Hypertension</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label english">Allergies</span>
                            <span class="info-label kannada">ಅಲರ್ಜಿಗಳು</span>
                            <span class="info-value">Penicillin</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label english">Next Appointment</span>
                            <span class="info-label kannada">ಮುಂದಿನ ನಿಯಮಿತ</span>
                            <span class="info-value">Today, 10:30 AM</span>
                        </div>
                    </div>

                    <div class="section-title" style="margin-top: 30px;">
                        <h2 class="english">Settings</h2>
                        <h2 class="kannada">ಸೆಟ್ಟಿಂಗ್ಸ್</h2>
                    </div>

                    <div class="medication-card">
                        <div class="medication-header">
                            <div>
                                <div class="medication-name english">Sound Notifications</div>
                                <div class="medication-name kannada">ಧ್ವನಿ ಅಧಿಸೂಚನೆಗಳು</div>
                                <div class="medication-dosage english">Enable sound alerts for reminders</div>
                                <div class="medication-dosage kannada">ಜ್ಞಾಪನೆಗಳಿಗಾಗಿ ಧ್ವನಿ ಎಚ್ಚರಿಕೆಗಳನ್ನು ಸಕ್ರಿಯಗೊಳಿಸಿ</div>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="soundToggle" checked>
                                <span class="slider"></span>
                            </div>
                        </div>
                    </div>

                    <div class="medication-card">
                        <div class="medication-header">
                            <div>
                                <div class="medication-name english">Voice Reminders</div>
                                <div class="medication-name kannada">ಧ್ವನಿ ಜ್ಞಾಪನೆಗಳು</div>
                                <div class="medication-dosage english">Enable voice notifications</div>
                                <div class="medication-dosage kannada">ಧ್ವನಿ ಅಧಿಸೂಚನೆಗಳನ್ನು ಸಕ್ರಿಯಗೊಳಿಸಿ</div>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="slider"></span>
                            </div>
                        </div>
                    </div>

                    <div class="medication-card">
                        <div class="medication-header">
                            <div>
                                <div class="medication-name english">Caregiver Access</div>
                                <div class="medication-name kannada">ಕೇರ್‌ಗಿವರ್ ಪ್ರವೇಶ</div>
                                <div class="medication-dosage english">Share health data with family</div>
                                <div class="medication-dosage kannada">ಕುಟುಂಬದೊಂದಿಗೆ ಆರೋಗ್ಯ ಡೇಟಾವನ್ನು ಹಂಚಿಕೊಳ್ಳಿ</div>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox">
                                <span class="slider"></span>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="logoutButton">
                        <i class="fas fa-sign-out-alt"></i>
                        <span class="english">Log Out</span>
                        <span class="kannada">ಲಾಗ್ ಔಟ್</span>
                    </button>
                </main>
            </div>

            <!-- AI Assistant -->
            <div class="ai-assistant" id="aiAssistant">
                <i class="fas fa-robot"></i>
            </div>

            <!-- Bottom Navigation -->
            <div class="bottom-nav">
                <div class="nav-item active" data-screen="homeScreen">
                    <i class="fas fa-home nav-icon"></i>
                    <span class="nav-label english">Home</span>
                    <span class="nav-label kannada">ಮುಖಪುಟ</span>
                </div>
                <div class="nav-item" data-screen="medicationsScreen">
                    <i class="fas fa-pills nav-icon"></i>
                    <span class="nav-label english">Meds</span>
                    <span class="nav-label kannada">ಔಷಧಿಗಳು</span>
                </div>
                <div class="nav-item" data-screen="appointmentsScreen">
                    <i class="fas fa-calendar-check nav-icon"></i>
                    <span class="nav-label english">Appointments</span>
                    <span class="nav-label kannada">ನಿಯಮಿತಗಳು</span>
                </div>
                <div class="nav-item" data-screen="healthScreen">
                    <i class="fas fa-heartbeat nav-icon"></i>
                    <span class="nav-label english">Health</span>
                    <span class="nav-label kannada">ಆರೋಗ್ಯ</span>
                </div>
                <div class="nav-item" data-screen="profileScreen">
                    <i class="fas fa-user nav-icon"></i>
                    <span class="nav-label english">Profile</span>
                    <span class="nav-label kannada">ಪ್ರೊಫೈಲ್</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sound Management System
        let soundEnabled = false;
        let soundsInitialized = false;
        let audioContext = null;
        let bpChart = null;

        // Medication Data
        const medicationData = [
            {
                id: 1,
                name: "Metformin 500mg",
                dosage: "1 tablet after food, Twice daily",
                dosageKannada: "ಊಟದ ನಂತರ 1 ಮಾತ್ರೆ, ದಿನಕ್ಕೆ ಎರಡು ಬಾರಿ",
                times: ["8:00 AM", "8:00 PM"],
                instructions: "Take 10-15 minutes after meals",
                instructionsKannada: "ಊಟಗಳ ನಂತರ 10-15 ನಿಮಿಷಗಳ ನಂತರ ತೆಗೆದುಕೊಳ್ಳಿ",
                history: [
                    { date: "Today, 8:00 AM", status: "Taken", note: "Taken after breakfast" },
                    { date: "Yesterday, 8:00 AM", status: "Taken", note: "Taken on time" },
                    { date: "Yesterday, 8:00 PM", status: "Taken", note: "Taken after dinner" }
                ]
            },
            {
                id: 2,
                name: "Atorvastatin 20mg",
                dosage: "1 tablet before bed, Once daily",
                dosageKannada: "ಮಲಗುವ ಮುನ್ನ 1 ಮಾತ್ರೆ, ದಿನಕ್ಕೆ ಒಮ್ಮೆ",
                times: ["10:00 PM"],
                instructions: "Take at bedtime on empty stomach",
                instructionsKannada: "ಖಾಲಿ ಹೊಟ್ಟೆಗೆ ಮಲಗುವ ಮುನ್ನ ತೆಗೆದುಕೊಳ್ಳಿ",
                history: [
                    { date: "Yesterday, 10:00 PM", status: "Taken", note: "Taken before bed" },
                    { date: "2 days ago, 10:00 PM", status: "Missed", note: "Forgot to take" }
                ]
            },
            {
                id: 3,
                name: "Aspirin 75mg",
                dosage: "1 tablet after breakfast, Once daily",
                dosageKannada: "ನಾಳ್ಕೆ ಊಟದ ನಂತರ 1 ಮಾತ್ರೆ, ದಿನಕ್ಕೆ ಒಮ್ಮೆ",
                times: ["9:00 AM"],
                instructions: "Take 15 minutes before breakfast",
                instructionsKannada: "ನಾಳ್ಕೆ ಊಟದ 15 ನಿಮಿಷಗಳ ಮುಂಚೆ ತೆಗೆದುಕೊಳ್ಳಿ",
                history: [
                    { date: "Today, 9:00 AM", status: "Taken", note: "Taken 15 min before breakfast" },
                    { date: "Yesterday, 9:00 AM", status: "Taken", note: "Taken on time" }
                ]
            }
        ];

        // Appointment Data
        const appointmentData = [
            {
                id: 1,
                doctor: "Dr. Anjali Sharma",
                specialization: "Cardiologist",
                date: "Today, 10:30 AM",
                status: "upcoming",
                details: {
                    dateTime: "Today, 10:30 AM",
                    specialization: "Cardiology",
                    location: "City Heart Clinic, MG Road",
                    contact: "+91 98765 43210"
                }
            },
            {
                id: 2,
                doctor: "Dr. Priya Desai",
                specialization: "General Physician",
                date: "2 days ago, 11:00 AM",
                status: "completed",
                details: {
                    dateTime: "2 days ago, 11:00 AM",
                    specialization: "General Medicine",
                    location: "MediCare Center, Brigade Road",
                    contact: "+91 98765 43211",
                    diagnosis: "Routine checkup - All parameters normal"
                }
            }
        ];

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial language
            toggleLanguage('en');
            
            // Load initial data
            loadMedicationData();
            loadAppointmentData();
            
            // Show welcome notification
            setTimeout(() => {
                showNotification(
                    'Welcome to MediSafe',
                    'Click "Enable Sounds" button to activate notifications',
                    'info'
                );
            }, 1000);
            
            // Setup event listeners
            setupEventListeners();
        });

        // Load medication data
        function loadMedicationData() {
            const medicationList = document.querySelector('.medication-list');
            if (!medicationList) return;
            
            medicationList.innerHTML = '';
            
            medicationData.forEach(med => {
                const card = document.createElement('div');
                card.className = 'medication-card';
                card.innerHTML = `
                    <div class="medication-header">
                        <div>
                            <div class="medication-name">${med.name}</div>
                            <div class="medication-dosage english">${med.dosage}</div>
                            <div class="medication-dosage kannada">${med.dosageKannada}</div>
                        </div>
                    </div>
                    <div class="medication-time">
                        <i class="far fa-clock"></i>
                        <span class="english">${med.times.join(' & ')}</span>
                        <span class="kannada">${med.times.join(' & ')}</span>
                    </div>
                    <div class="medicine-instructions">
                        <div class="instructions-title">
                            <i class="fas fa-info-circle"></i>
                            <span class="english">${med.instructions}</span>
                            <span class="kannada">${med.instructionsKannada}</span>
                        </div>
                    </div>
                    <div class="medication-actions">
                        <button class="btn btn-primary edit-med-btn" data-id="${med.id}">
                            <i class="fas fa-edit"></i>
                            <span class="english">Edit</span>
                            <span class="kannada">ಸಂಪಾದಿಸಿ</span>
                        </button>
                        <button class="btn btn-secondary history-med-btn" data-id="${med.id}">
                            <i class="fas fa-history"></i>
                            <span class="english">History</span>
                            <span class="kannada">ಇತಿಹಾಸ</span>
                        </button>
                    </div>
                `;
                medicationList.appendChild(card);
            });
        }

        // Load appointment data
        function loadAppointmentData() {
            const appointmentList = document.querySelector('.appointment-list');
            if (!appointmentList) return;
            
            appointmentList.innerHTML = '';
            
            // Upcoming appointments section
            const upcomingSection = document.createElement('div');
            upcomingSection.innerHTML = `
                <div class="section-title" style="margin-top: 20px;">
                    <h3 class="english">Upcoming Appointments</h3>
                    <h3 class="kannada">ಮುಂಬರುವ ನಿಯಮಿತಗಳು</h3>
                </div>
            `;
            appointmentList.appendChild(upcomingSection);
            
            // Upcoming appointments
            appointmentData.filter(a => a.status === 'upcoming').forEach(app => {
                const card = createAppointmentCard(app);
                appointmentList.appendChild(card);
            });
            
            // Completed appointments section
            const completedSection = document.createElement('div');
            completedSection.innerHTML = `
                <div class="section-title" style="margin-top: 20px;">
                    <h3 class="english">Completed Appointments</h3>
                    <h3 class="kannada">ಪೂರ್ಣಗೊಂಡ ನಿಯಮಿತಗಳು</h3>
                </div>
            `;
            appointmentList.appendChild(completedSection);
            
            // Completed appointments
            appointmentData.filter(a => a.status === 'completed').forEach(app => {
                const card = createAppointmentCard(app);
                appointmentList.appendChild(card);
            });
        }

        // Create appointment card
        function createAppointmentCard(app) {
            const card = document.createElement('div');
            card.className = 'appointment-card';
            card.innerHTML = `
                <div class="appointment-header">
                    <div>
                        <div class="appointment-doctor">${app.doctor}</div>
                        <div class="appointment-specialization">${app.specialization}</div>
                    </div>
                    <div>
                        <span class="appointment-status status-${app.status}">${app.status === 'upcoming' ? 'Upcoming' : 'Completed'}</span>
                    </div>
                </div>
                <div class="appointment-date">
                    <i class="far fa-calendar"></i>
                    <span>${app.date}</span>
                </div>
                <div class="appointment-details">
                    <div class="detail-row">
                        <div class="detail-label english">Date & Time:</div>
                        <div class="detail-value">${app.details.dateTime}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label english">Specialization:</div>
                        <div class="detail-value">${app.details.specialization}</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label english">Status:</div>
                        <div class="detail-value"><span class="appointment-status status-${app.status}">${app.status === 'upcoming' ? 'Upcoming' : 'Completed'}</span></div>
                    </div>
                    ${app.details.diagnosis ? `
                    <div class="detail-row">
                        <div class="detail-label english">Diagnosis:</div>
                        <div class="detail-value">${app.details.diagnosis}</div>
                    </div>
                    ` : ''}
                </div>
                <div class="appointment-actions">
                    ${app.status === 'upcoming' ? `
                    <button class="btn btn-primary reschedule-btn" data-id="${app.id}">
                        <i class="fas fa-edit"></i>
                        <span class="english">Reschedule</span>
                        <span class="kannada">ಮರುಸಂಧಾನ</span>
                    </button>
                    <button class="btn btn-secondary call-clinic-btn" data-id="${app.id}">
                        <i class="fas fa-phone"></i>
                        <span class="english">Call Clinic</span>
                        <span class="kannada">ಕ್ಲಿನಿಕ್‌ಗೆ ಕರೆ</span>
                    </button>
                    ` : `
                    <button class="btn btn-primary view-report-btn" data-id="${app.id}">
                        <i class="fas fa-file-medical"></i>
                        <span class="english">View Report</span>
                        <span class="kannada">ವರದಿ ನೋಡಿ</span>
                    </button>
                    <button class="btn btn-secondary book-again-btn" data-id="${app.id}">
                        <i class="fas fa-redo"></i>
                        <span class="english">Book Again</span>
                        <span class="kannada">ಮತ್ತೆ ಬುಕ್ ಮಾಡಿ</span>
                    </button>
                    `}
                </div>
            `;
            return card;
        }

        // Enable Sounds Button
        document.getElementById('enableSoundBtn').addEventListener('click', function() {
            initializeSounds();
            this.style.display = 'none';
            showNotification(
                'Sounds Enabled',
                'Sound notifications are now active',
                'success'
            );
        });

        // Initialize all sounds
        function initializeSounds() {
            if (soundsInitialized) return;
            
            try {
                const silentAudio = new Audio();
                silentAudio.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=';
                silentAudio.volume = 0.001;
                silentAudio.play().then(() => {
                    silentAudio.pause();
                    silentAudio.currentTime = 0;
                });
                
                soundsInitialized = true;
                soundEnabled = true;
                
                const soundControl = document.getElementById('soundControl');
                soundControl.classList.remove('muted');
                soundControl.querySelector('i').className = 'fas fa-volume-up';
                
                setTimeout(() => {
                    playTestSound();
                }, 100);
                
            } catch (error) {
                console.error('Error initializing sounds:', error);
            }
        }

        // Play test sound
        function playTestSound() {
            if (!soundEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
                
            } catch (error) {
                console.log('Fallback sound used');
            }
        }

        // Play sound by ID
        function playSound(soundId) {
            if (!soundEnabled || !soundsInitialized) return;
            
            try {
                const audio = document.getElementById(soundId);
                if (audio) {
                    audio.currentTime = 0;
                    audio.volume = 0.7;
                    audio.play().catch(e => console.log('Audio play failed'));
                }
            } catch (error) {
                console.error('Error playing sound:', error);
            }
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Login
            document.getElementById('loginButton').addEventListener('click', handleLogin);
            
            // Logout
            document.getElementById('logoutButton').addEventListener('click', handleLogout);
            
            // Language
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    toggleLanguage(lang);
                });
            });
            
            // Main language toggle
            document.getElementById('languageToggle').addEventListener('click', function() {
                const currentLang = document.querySelector('.english').style.display === 'none' ? 'kn' : 'en';
                toggleLanguage(currentLang === 'en' ? 'kn' : 'en');
            });
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const targetScreen = this.getAttribute('data-screen');
                    
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    document.querySelectorAll('.screen').forEach(screen => {
                        if (screen.id !== 'loginScreen' && screen.id !== 'mainApp') {
                            screen.classList.remove('active');
                        }
                    });
                    document.getElementById(targetScreen).classList.add('active');
                    
                    if (targetScreen === 'healthScreen') {
                        setTimeout(initializeHealthChart, 100);
                    }
                });
            });
            
            // Back buttons
            document.getElementById('backToHomeFromMeds').addEventListener('click', navigateToHome);
            document.getElementById('backToHomeFromAppointments').addEventListener('click', navigateToHome);
            document.getElementById('backToHomeFromHealth').addEventListener('click', navigateToHome);
            
            // Sound control
            document.getElementById('soundControl').addEventListener('click', function() {
                if (!soundsInitialized) {
                    initializeSounds();
                    return;
                }
                
                soundEnabled = !soundEnabled;
                const icon = this.querySelector('i');
                
                if (soundEnabled) {
                    this.classList.remove('muted');
                    icon.className = 'fas fa-volume-up';
                    playSound('successSound');
                    showNotification('Sound Enabled', 'Sound notifications enabled', 'success');
                } else {
                    this.classList.add('muted');
                    icon.className = 'fas fa-volume-mute';
                    showNotification('Sound Disabled', 'Sound notifications muted', 'info');
                }
                
                document.getElementById('soundTestPanel').classList.toggle('active');
            });
            
            // Sound test buttons
            document.getElementById('testReminderSound').addEventListener('click', () => {
                if (!soundsInitialized) {
                    initializeSounds();
                    return;
                }
                playSound('medicationSound');
                showNotification('Test Sound', 'Playing reminder sound', 'info');
            });
            
            document.getElementById('testEmergencySound').addEventListener('click', () => {
                if (!soundsInitialized) {
                    initializeSounds();
                    return;
                }
                playSound('emergencySound');
                showNotification('Test Sound', 'Playing emergency sound', 'warning');
            });
            
            document.getElementById('testSuccessSound').addEventListener('click', () => {
                if (!soundsInitialized) {
                    initializeSounds();
                    return;
                }
                playSound('successSound');
                showNotification('Test Sound', 'Playing success sound', 'success');
            });
            
            document.getElementById('testDeepSound').addEventListener('click', () => {
                if (!soundsInitialized) {
                    initializeSounds();
                    return;
                }
                playSound('deepAlertSound');
                showNotification('Test Sound', 'Playing deep alert', 'info');
            });
            
            document.getElementById('testBeepSound').addEventListener('click', () => {
                if (!soundsInitialized) {
                    initializeSounds();
                    return;
                }
                playTestSound();
                showNotification('Test Sound', 'Playing beep sound', 'info');
            });
            
            // Sound toggle in settings
            document.getElementById('soundToggle').addEventListener('change', function() {
                if (!soundsInitialized) {
                    initializeSounds();
                    return;
                }
                
                soundEnabled = this.checked;
                const soundControl = document.getElementById('soundControl');
                const icon = soundControl.querySelector('i');
                
                if (soundEnabled) {
                    soundControl.classList.remove('muted');
                    icon.className = 'fas fa-volume-up';
                    playSound('successSound');
                } else {
                    soundControl.classList.add('muted');
                    icon.className = 'fas fa-volume-mute';
                }
            });
            
            // Accessibility
            document.getElementById('accessibilityToggle').addEventListener('click', function() {
                const panel = document.getElementById('accessibilityPanel');
                panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
                document.getElementById('soundTestPanel').classList.remove('active');
            });
            
            document.getElementById('closeAccessibility').addEventListener('click', function() {
                document.getElementById('accessibilityPanel').style.display = 'none';
            });
            
            // Text size
            document.querySelectorAll('.text-size-btn').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.text-size-btn').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const size = this.getAttribute('data-size');
                    document.body.className = '';
                    if (size !== 'medium') {
                        document.body.classList.add(size);
                    }
                });
            });
            
            // High contrast
            document.getElementById('highContrastToggle').addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('high-contrast');
                } else {
                    document.body.classList.remove('high-contrast');
                }
            });
            
            // Medication taken buttons
            document.addEventListener('click', function(e) {
                if (e.target.closest('.btn-success')) {
                    const button = e.target.closest('.btn-success');
                    const medicationName = button.getAttribute('data-medication') || 'Medication';
                    const card = button.closest('.medication-card');
                    card.style.opacity = '0.7';
                    card.style.backgroundColor = '#F0F9FF';
                    button.innerHTML = '<i class="fas fa-check"></i> <span class="english">Taken</span><span class="kannada">ತೆಗೆದುಕೊಂಡಿದೆ</span>';
                    button.classList.remove('btn-success');
                    button.classList.add('btn-secondary');
                    
                    if (soundEnabled) playSound('successSound');
                    
                    showNotification(
                        'Medication Taken',
                        `${medicationName} marked as taken`,
                        'success'
                    );
                }
                
                // Edit medication button
                if (e.target.closest('.edit-med-btn')) {
                    const button = e.target.closest('.edit-med-btn');
                    const medId = parseInt(button.getAttribute('data-id'));
                    const medication = medicationData.find(m => m.id === medId);
                    
                    if (medication) {
                        showEditMedicationModal(medication);
                    }
                }
                
                // Medication history button
                if (e.target.closest('.history-med-btn')) {
                    const button = e.target.closest('.history-med-btn');
                    const medId = parseInt(button.getAttribute('data-id'));
                    const medication = medicationData.find(m => m.id === medId);
                    
                    if (medication) {
                        showMedicationHistoryModal(medication);
                    }
                }
                
                // View details button (home page)
                if (e.target.closest('.view-report-btn')) {
                    showAppointmentDetails();
                }
                
                // Call button (home page)
                if (e.target.closest('.call-clinic-btn')) {
                    const clinicNumber = "+91 98765 43210";
                    showCallSimulation(clinicNumber);
                }
                
                // Reschedule button (appointments)
                if (e.target.closest('.reschedule-btn')) {
                    const button = e.target.closest('.reschedule-btn');
                    const appId = parseInt(button.getAttribute('data-id'));
                    const appointment = appointmentData.find(a => a.id === appId);
                    
                    if (appointment) {
                        showRescheduleModal(appointment);
                    }
                }
                
                // Call clinic button (appointments)
                if (e.target.closest('.call-clinic-btn') && e.target.closest('.appointment-card')) {
                    const button = e.target.closest('.call-clinic-btn');
                    const appId = parseInt(button.getAttribute('data-id'));
                    const appointment = appointmentData.find(a => a.id === appId);
                    
                    if (appointment) {
                        showCallSimulation(appointment.details.contact);
                    }
                }
                
                // View report button (appointments)
                if (e.target.closest('.view-report-btn') && e.target.closest('.appointment-card')) {
                    const button = e.target.closest('.view-report-btn');
                    const appId = parseInt(button.getAttribute('data-id'));
                    const appointment = appointmentData.find(a => a.id === appId);
                    
                    if (appointment) {
                        downloadMedicalReport(appointment);
                    }
                }
                
                // Book again button (appointments)
                if (e.target.closest('.book-again-btn')) {
                    const button = e.target.closest('.book-again-btn');
                    const appId = parseInt(button.getAttribute('data-id'));
                    const appointment = appointmentData.find(a => a.id === appId);
                    
                    if (appointment) {
                        showBookAgainModal(appointment);
                    }
                }
            });
            
            // AI Assistant
            document.getElementById('aiAssistant').addEventListener('click', function() {
                document.getElementById('aiChatModal').classList.add('active');
                if (soundEnabled) playSound('appointmentSound');
            });
            
            document.getElementById('aiChatClose').addEventListener('click', function() {
                document.getElementById('aiChatModal').classList.remove('active');
            });
            
            document.getElementById('aiChatSend').addEventListener('click', sendAIMessage);
            document.getElementById('aiChatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendAIMessage();
            });
            
            // Add medication button
            document.getElementById('addMedication').addEventListener('click', function() {
                if (soundEnabled) playSound('medicationSound');
                showAddMedicationModal();
            });
            
            // Add appointment button
            document.getElementById('addAppointment').addEventListener('click', function() {
                if (soundEnabled) playSound('appointmentSound');
                showAddAppointmentModal();
            });
            
            // Close modals when clicking outside
            document.getElementById('aiChatModal').addEventListener('click', function(e) {
                if (e.target === this) this.classList.remove('active');
            });
            
            document.addEventListener('click', function(e) {
                const soundControl = document.getElementById('soundControl');
                const soundPanel = document.getElementById('soundTestPanel');
                
                if (!soundControl.contains(e.target) && !soundPanel.contains(e.target) && soundPanel.classList.contains('active')) {
                    soundPanel.classList.remove('active');
                }
            });
            
            // Initialize chart if health screen is active
            if (document.getElementById('healthScreen').classList.contains('active')) {
                setTimeout(initializeHealthChart, 500);
            }
        }

        // Login handler
        function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email && password) {
                document.getElementById('loginScreen').classList.remove('active');
                document.getElementById('mainApp').classList.add('active');
                document.getElementById('homeScreen').classList.add('active');
                
                if (soundEnabled) {
                    setTimeout(() => playSound('successSound'), 500);
                }
                
                showNotification('Welcome Back!', 'Your medications and appointments are ready', 'success');
                
                scheduleMedicationReminders();
                
                setTimeout(initializeHealthChart, 500);
                
            } else {
                showNotification('Login Error', 'Please enter both email and password', 'warning');
            }
        }

        // Logout handler
        function handleLogout() {
            document.getElementById('mainApp').classList.remove('active');
            document.getElementById('loginScreen').classList.add('active');
            
            document.querySelectorAll('.screen').forEach(screen => {
                if (screen.id !== 'loginScreen' && screen.id !== 'mainApp') {
                    screen.classList.remove('active');
                }
            });
            document.getElementById('homeScreen').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('.nav-item[data-screen="homeScreen"]').classList.add('active');
            
            document.getElementById('aiChatModal').classList.remove('active');
            document.getElementById('soundTestPanel').classList.remove('active');
            
            showNotification('Logged Out', 'You have been successfully logged out', 'info');
            
            if (soundEnabled) playSound('successSound');
        }

        // Toggle language
        function toggleLanguage(lang) {
            const englishElements = document.querySelectorAll('.english');
            const kannadaElements = document.querySelectorAll('.kannada');
            
            if (lang === 'en') {
                englishElements.forEach(el => el.style.display = 'inline');
                kannadaElements.forEach(el => el.style.display = 'none');
            } else {
                englishElements.forEach(el => el.style.display = 'none');
                kannadaElements.forEach(el => el.style.display = 'inline');
            }
        }

        // Navigate to home
        function navigateToHome() {
            document.querySelectorAll('.screen').forEach(screen => {
                if (screen.id !== 'loginScreen' && screen.id !== 'mainApp') {
                    screen.classList.remove('active');
                }
            });
            document.getElementById('homeScreen').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('.nav-item[data-screen="homeScreen"]').classList.add('active');
        }

        // AI Chat message
        function sendAIMessage() {
            const input = document.getElementById('aiChatInput');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage(message, 'user');
                input.value = '';
                
                if (soundEnabled) playSound('successSound');
                
                setTimeout(() => {
                    const responses = [
                        "I can help you set medication reminders. Would you like me to remind you about your Metformin dose?",
                        "Your next appointment with Dr. Anjali Sharma is today at 10:30 AM. Would you like me to call the clinic?",
                        "Your blood pressure is looking good at 122/80. Keep up the good work!",
                        "I can help you track your health metrics. Would you like to log your blood sugar reading?",
                        "Remember to take your medications with food as directed for better absorption."
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addChatMessage(randomResponse, 'ai');
                    
                    if (soundEnabled) playSound('appointmentSound');
                }, 1000);
            }
        }

        // Add chat message
        function addChatMessage(message, type) {
            const chatBody = document.getElementById('aiChatBody');
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'user' ? 'user-message' : 'ai-message';
            messageDiv.textContent = message;
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Show notification
        function showNotification(title, message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            let icon = 'fa-info-circle';
            if (type === 'success') icon = 'fa-check-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            if (soundEnabled) {
                if (type === 'warning') playSound('medicationSound');
                else if (type === 'success') playSound('successSound');
                else playSound('appointmentSound');
            }
            
            setTimeout(() => {
                if (notification.parentNode === container) {
                    notification.remove();
                }
            }, 5000);
            
            notification.querySelector('.notification-close').addEventListener('click', function() {
                notification.remove();
            });
        }

        // Schedule medication reminders
        function scheduleMedicationReminders() {
            setTimeout(() => {
                showNotification(
                    'Medication Reminder',
                    'Remember to take Metformin 500mg 10-15 minutes after your meal',
                    'warning'
                );
            }, 2000);
            
            setInterval(() => {
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                
                if (currentHour === 8 && currentMinute === 0) {
                    showNotification('Morning Medication', 'Time to take Metformin 500mg after breakfast', 'warning');
                }
                
                if (currentHour === 9 && currentMinute === 0) {
                    showNotification('Morning Medication', 'Time to take Aspirin 75mg 15 minutes before breakfast', 'warning');
                }
                
                if (currentHour === 20 && currentMinute === 0) {
                    showNotification('Evening Medication', 'Time to take Metformin 500mg after dinner', 'warning');
                }
                
                if (currentHour === 22 && currentMinute === 0) {
                    showNotification('Bedtime Medication', 'Time to take Atorvastatin 20mg before bed', 'warning');
                }
            }, 60000);
        }

        // Initialize health chart
        function initializeHealthChart() {
            const ctx = document.getElementById('bpChart');
            const placeholder = document.getElementById('chartPlaceholder');
            
            if (!ctx) {
                console.error('Canvas element not found');
                return;
            }
            
            if (placeholder) {
                placeholder.style.display = 'flex';
            }
            
            if (bpChart) {
                bpChart.destroy();
                bpChart = null;
            }
            
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                if (placeholder) {
                    placeholder.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-exclamation-triangle" style="color: #EF4444; font-size: 2rem; margin-bottom: 15px;"></i>
                            <div class="english" style="color: var(--gray-700); margin-bottom: 10px;">Chart library not loaded</div>
                            <div class="kannada" style="color: var(--gray-700); margin-bottom: 10px; display: none;">ಚಾರ್ಟ್ ಲೈಬ್ರರಿ ಲೋಡ್ ಆಗಿಲ್ಲ</div>
                            <div style="color: var(--gray-500); font-size: 0.9rem; margin-top: 10px;">
                                <span class="english">Please refresh the page</span>
                                <span class="kannada" style="display: none;">ದಯವಿಟ್ಟು ಪುಟವನ್ನು ರಿಫ್ರೆಶ್ ಮಾಡಿ</span>
                            </div>
                        </div>
                    `;
                }
                return;
            }
            
            setTimeout(() => {
                try {
                    if (placeholder) {
                        placeholder.style.display = 'none';
                    }
                    
                    const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    const systolicData = [125, 128, 122, 120, 118, 122, 120];
                    const diastolicData = [82, 85, 80, 78, 76, 80, 78];
                    
                    bpChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: days,
                            datasets: [
                                {
                                    label: 'Systolic (mmHg)',
                                    data: systolicData,
                                    borderColor: '#2563EB',
                                    backgroundColor: 'rgba(37, 99, 235, 0.1)',
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true,
                                    pointBackgroundColor: '#2563EB',
                                    pointBorderColor: '#ffffff',
                                    pointBorderWidth: 2,
                                    pointRadius: 5
                                },
                                {
                                    label: 'Diastolic (mmHg)',
                                    data: diastolicData,
                                    borderColor: '#10B981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    borderWidth: 3,
                                    tension: 0.4,
                                    fill: true,
                                    pointBackgroundColor: '#10B981',
                                    pointBorderColor: '#ffffff',
                                    pointBorderWidth: 2,
                                    pointRadius: 5
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                title: {
                                    display: true,
                                    text: 'Blood Pressure Trend - Last 7 Days'
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    min: 70,
                                    max: 130,
                                    ticks: {
                                        callback: function(value) {
                                            return value + ' mmHg';
                                        }
                                    }
                                }
                            }
                        }
                    });
                    
                } catch (error) {
                    console.error('Error creating chart:', error);
                    if (placeholder) {
                        placeholder.innerHTML = `
                            <div style="text-align: center; padding: 20px;">
                                <i class="fas fa-chart-line" style="color: var(--gray-400); font-size: 3rem; margin-bottom: 15px;"></i>
                                <div class="english" style="color: var(--gray-700); margin-bottom: 10px;">Chart displayed here</div>
                                <div class="kannada" style="color: var(--gray-700); margin-bottom: 10px; display: none;">ಚಾರ್ಟ್ ಇಲ್ಲಿ ಪ್ರದರ್ಶಿಸಲಾಗುತ್ತದೆ</div>
                                <div style="color: var(--gray-500); font-size: 0.9rem; margin-top: 10px;">
                                    <span class="english">Sample data: 122/80 mmHg avg</span>
                                    <span class="kannada" style="display: none;">ಮಾದರಿ ದತ್ತಾಂಶ: 122/80 mmHg ಸರಾಸರಿ</span>
                                </div>
                            </div>
                        `;
                        placeholder.style.display = 'flex';
                    }
                }
            }, 300);
        }

        // Show edit medication modal
        function showEditMedicationModal(medication) {
            if (soundEnabled) playSound('medicationSound');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Edit Medication</h3>
                        <p>Update the details for ${medication.name}</p>
                    </div>
                    <div class="form-group">
                        <label for="medName">Medication Name</label>
                        <input type="text" id="medName" value="${medication.name}">
                    </div>
                    <div class="form-group">
                        <label for="medDosage">Dosage Instructions</label>
                        <input type="text" id="medDosage" value="${medication.dosage}">
                    </div>
                    <div class="form-group">
                        <label for="medTimes">Times (comma separated)</label>
                        <input type="text" id="medTimes" value="${medication.times.join(', ')}">
                    </div>
                    <div class="form-group">
                        <label for="medInstructions">Special Instructions</label>
                        <textarea id="medInstructions">${medication.instructions}</textarea>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-cancel" id="cancelEdit">Cancel</button>
                        <button class="modal-confirm" id="saveEdit">Save Changes</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('cancelEdit').addEventListener('click', function() {
                document.body.removeChild(modal);
                showNotification('Cancelled', 'Changes cancelled', 'info');
            });
            
            document.getElementById('saveEdit').addEventListener('click', function() {
                const newName = document.getElementById('medName').value;
                const newDosage = document.getElementById('medDosage').value;
                const newTimes = document.getElementById('medTimes').value.split(',').map(t => t.trim());
                const newInstructions = document.getElementById('medInstructions').value;
                
                medication.name = newName;
                medication.dosage = newDosage;
                medication.times = newTimes;
                medication.instructions = newInstructions;
                
                loadMedicationData();
                document.body.removeChild(modal);
                
                showNotification('Medication Updated', `${newName} has been updated`, 'success');
                if (soundEnabled) playSound('successSound');
            });
        }

        // Show medication history modal
        function showMedicationHistoryModal(medication) {
            if (soundEnabled) playSound('appointmentSound');
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            
            let historyHTML = '';
            medication.history.forEach(item => {
                historyHTML += `
                    <div style="padding: 10px; border-bottom: 1px solid var(--gray-200);">
                        <div style="font-weight: 600; color: var(--gray-700);">${item.date}</div>
                        <div style="color: ${item.status === 'Taken' ? 'var(--success)' : 'var(--danger)'};">Status: ${item.status}</div>
                        <div style="color: var(--gray-600); font-size: 0.9rem;">${item.note}</div>
                    </div>
                `;
            });
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${medication.name} History</h3>
                        <p>Medication intake history for the past week</p>
                    </div>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${historyHTML}
                    </div>
                    <div class="modal-actions">
                        <button class="modal-confirm" id="closeHistory">Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('closeHistory').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
        }

        // Show appointment details
        function showAppointmentDetails() {
            if (soundEnabled) playSound('appointmentSound');
            
            const appointment = appointmentData.find(a => a.status === 'upcoming');
            if (!appointment) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Appointment Details</h3>
                        <p>Details for your upcoming appointment</p>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; color: var(--gray-700); margin-bottom: 5px;">Doctor</div>
                            <div>${appointment.doctor}</div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; color: var(--gray-700); margin-bottom: 5px;">Specialization</div>
                            <div>${appointment.specialization}</div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; color: var(--gray-700); margin-bottom: 5px;">Date & Time</div>
                            <div>${appointment.date}</div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; color: var(--gray-700); margin-bottom: 5px;">Location</div>
                            <div>${appointment.details.location}</div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-weight: 600; color: var(--gray-700); margin-bottom: 5px;">Contact</div>
                            <div>${appointment.details.contact}</div>
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-confirm" id="closeDetails">Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('closeDetails').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
        }

        // Show call simulation
        function showCallSimulation(phoneNumber) {
            if (soundEnabled) playSound('appointmentSound');
            
            const modal = document.createElement('div');
            modal.className = 'call-simulation';
            modal.innerHTML = `
                <div class="call-content">
                    <h3>📞 Calling Clinic</h3>
                    <div class="call-number">${phoneNumber}</div>
                    <div class="call-actions">
                        <button class="call-mute" id="muteCall">Mute</button>
                        <button class="call-end" id="endCall">End Call</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            let muted = false;
            document.getElementById('muteCall').addEventListener('click', function() {
                muted = !muted;
                this.textContent = muted ? 'Unmute' : 'Mute';
                showNotification(muted ? 'Call Muted' : 'Call Unmuted', '', 'info');
            });
            
            document.getElementById('endCall').addEventListener('click', function() {
                document.body.removeChild(modal);
                showNotification('Call Ended', 'Call to clinic has ended', 'info');
            });
            
            // Auto end call after 30 seconds
            setTimeout(() => {
                if (document.body.contains(modal)) {
                    document.body.removeChild(modal);
                    showNotification('Call Ended', 'Simulated call completed', 'info');
                }
            }, 30000);
        }

        // Show reschedule modal
        function showRescheduleModal(appointment) {
            if (soundEnabled) playSound('medicationSound');
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Reschedule Appointment</h3>
                        <p>Reschedule your appointment with ${appointment.doctor}</p>
                    </div>
                    <div class="form-group">
                        <label for="rescheduleDate">New Date</label>
                        <input type="date" id="rescheduleDate" value="${tomorrowStr}" min="${tomorrowStr}">
                    </div>
                    <div class="form-group">
                        <label for="rescheduleTime">New Time</label>
                        <select id="rescheduleTime">
                            <option value="09:00">09:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="14:00">02:00 PM</option>
                            <option value="15:00">03:00 PM</option>
                            <option value="16:00">04:00 PM</option>
                        </select>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-cancel" id="cancelReschedule">Cancel</button>
                        <button class="modal-confirm" id="confirmReschedule">Reschedule</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('cancelReschedule').addEventListener('click', function() {
                document.body.removeChild(modal);
                showNotification('Cancelled', 'Reschedule cancelled', 'info');
            });
            
            document.getElementById('confirmReschedule').addEventListener('click', function() {
                const date = document.getElementById('rescheduleDate').value;
                const time = document.getElementById('rescheduleTime').value;
                
                if (!date) {
                    showNotification('Error', 'Please select a date', 'warning');
                    return;
                }
                
                const formattedDate = new Date(date + 'T' + time).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const formattedTime = parseInt(time) <= 12 ? time + ' AM' : (parseInt(time) - 12) + ':00 PM';
                
                appointment.date = `${formattedDate}, ${formattedTime}`;
                appointment.details.dateTime = `${formattedDate}, ${formattedTime}`;
                
                loadAppointmentData();
                document.body.removeChild(modal);
                
                showNotification('Appointment Rescheduled', `Your appointment has been rescheduled to ${formattedDate} at ${formattedTime}`, 'success');
                if (soundEnabled) playSound('successSound');
            });
        }

        // Download medical report
        function downloadMedicalReport(appointment) {
            if (soundEnabled) playSound('successSound');
            
            showNotification('Generating Report', 'Creating your medical report...', 'info');
            
            // Create PDF report using jsPDF
            try {
                if (typeof window.jspdf !== 'undefined') {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Add content to PDF
                    doc.setFontSize(20);
                    doc.setTextColor(37, 99, 235);
                    doc.text('MEDI-SAFE MEDICAL REPORT', 105, 20, null, null, 'center');
                    
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    
                    doc.text(`Patient: John Doe`, 20, 40);
                    doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 50);
                    doc.text(`Doctor: ${appointment.doctor}`, 20, 60);
                    doc.text(`Specialization: ${appointment.specialization}`, 20, 70);
                    doc.text(`Appointment Date: ${appointment.date}`, 20, 80);
                    
                    // Add medical summary
                    doc.setFontSize(14);
                    doc.text('Medical Summary', 20, 100);
                    doc.setFontSize(12);
                    
                    const summary = `
                        Patient underwent routine checkup with ${appointment.doctor}.
                        Blood pressure: 122/80 mmHg (Normal)
                        Blood sugar: 98 mg/dL (Normal)
                        Heart rate: 72 bpm (Normal)
                        Weight: 72 kg
                        
                        Recommendations:
                        - Continue current medication regimen
                        - Maintain healthy diet and exercise
                        - Follow-up in 3 months
                        
                        Prescribed Medications:
                        - Metformin 500mg: 1 tablet twice daily
                        - Atorvastatin 20mg: 1 tablet at bedtime
                        - Aspirin 75mg: 1 tablet daily
                    `;
                    
                    const splitText = doc.splitTextToSize(summary, 170);
                    doc.text(splitText, 20, 110);
                    
                    // Save the PDF
                    doc.save(`Medical_Report_${appointment.doctor.replace(' ', '_')}_${new Date().toISOString().split('T')[0]}.pdf`);
                    
                    showNotification('Report Downloaded', 'Medical report PDF has been downloaded', 'success');
                } else {
                    // Fallback to text file
                    const reportContent = `
MEDICAL REPORT
==============
Patient: John Doe
Date: ${new Date().toLocaleDateString()}
Doctor: ${appointment.doctor}
Specialization: ${appointment.specialization}
Appointment Date: ${appointment.date}

SUMMARY:
${appointment.details.diagnosis || 'Routine checkup completed. All parameters normal.'}

VITAL SIGNS:
- Blood Pressure: 122/80 mmHg
- Blood Sugar: 98 mg/dL
- Heart Rate: 72 bpm
- Weight: 72 kg

RECOMMENDATIONS:
1. Continue current medication regimen
2. Maintain healthy lifestyle
3. Schedule follow-up in 3 months
4. Contact clinic if any concerns arise

Signature: ${appointment.doctor}
License: MD-${Math.floor(Math.random() * 1000000)}
                    `;
                    
                    const blob = new Blob([reportContent], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `Medical_Report_${appointment.doctor.replace(' ', '_')}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showNotification('Report Downloaded', 'Medical report TXT has been downloaded', 'success');
                }
            } catch (error) {
                console.error('Error generating report:', error);
                showNotification('Error', 'Failed to generate report. Please try again.', 'warning');
            }
        }

        // Show book again modal
        function showBookAgainModal(appointment) {
            if (soundEnabled) playSound('successSound');
            
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const nextWeekStr = nextWeek.toISOString().split('T')[0];
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Book Appointment</h3>
                        <p>Book another appointment with ${appointment.doctor}</p>
                    </div>
                    <div class="form-group">
                        <label for="bookDate">Preferred Date</label>
                        <input type="date" id="bookDate" value="${nextWeekStr}" min="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div class="form-group">
                        <label for="bookTime">Preferred Time</label>
                        <select id="bookTime">
                            <option value="09:00">09:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="14:00">02:00 PM</option>
                            <option value="15:00">03:00 PM</option>
                            <option value="16:00">04:00 PM</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="bookReason">Reason for Visit</label>
                        <textarea id="bookReason" placeholder="Describe your symptoms or concerns"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-cancel" id="cancelBook">Cancel</button>
                        <button class="modal-confirm" id="confirmBook">Book Appointment</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('cancelBook').addEventListener('click', function() {
                document.body.removeChild(modal);
                showNotification('Cancelled', 'Booking cancelled', 'info');
            });
            
            document.getElementById('confirmBook').addEventListener('click', function() {
                const date = document.getElementById('bookDate').value;
                const time = document.getElementById('bookTime').value;
                const reason = document.getElementById('bookReason').value;
                
                if (!date || !reason.trim()) {
                    showNotification('Error', 'Please fill all required fields', 'warning');
                    return;
                }
                
                const formattedDate = new Date(date + 'T' + time).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const formattedTime = parseInt(time) <= 12 ? time + ' AM' : (parseInt(time) - 12) + ':00 PM';
                
                // Add new appointment
                const newAppointment = {
                    id: appointmentData.length + 1,
                    doctor: appointment.doctor,
                    specialization: appointment.specialization,
                    date: `${formattedDate}, ${formattedTime}`,
                    status: 'upcoming',
                    details: {
                        dateTime: `${formattedDate}, ${formattedTime}`,
                        specialization: appointment.specialization,
                        location: appointment.details.location,
                        contact: appointment.details.contact,
                        reason: reason
                    }
                };
                
                appointmentData.push(newAppointment);
                loadAppointmentData();
                document.body.removeChild(modal);
                
                showNotification('Appointment Booked', `Your appointment has been booked for ${formattedDate} at ${formattedTime}`, 'success');
                if (soundEnabled) playSound('successSound');
            });
        }

        // Show add medication modal
        function showAddMedicationModal() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Add New Medication</h3>
                        <p>Add a new medication to your schedule</p>
                    </div>
                    <div class="form-group">
                        <label for="newMedName">Medication Name</label>
                        <input type="text" id="newMedName" placeholder="e.g., Metformin 500mg">
                    </div>
                    <div class="form-group">
                        <label for="newMedDosage">Dosage Instructions</label>
                        <input type="text" id="newMedDosage" placeholder="e.g., 1 tablet after food, Twice daily">
                    </div>
                    <div class="form-group">
                        <label for="newMedTimes">Times (comma separated)</label>
                        <input type="text" id="newMedTimes" placeholder="e.g., 8:00 AM, 8:00 PM">
                    </div>
                    <div class="form-group">
                        <label for="newMedInstructions">Special Instructions</label>
                        <textarea id="newMedInstructions" placeholder="Any special instructions for this medication"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-cancel" id="cancelNewMed">Cancel</button>
                        <button class="modal-confirm" id="saveNewMed">Add Medication</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('cancelNewMed').addEventListener('click', function() {
                document.body.removeChild(modal);
                showNotification('Cancelled', 'New medication cancelled', 'info');
            });
            
            document.getElementById('saveNewMed').addEventListener('click', function() {
                const name = document.getElementById('newMedName').value;
                const dosage = document.getElementById('newMedDosage').value;
                const times = document.getElementById('newMedTimes').value.split(',').map(t => t.trim());
                const instructions = document.getElementById('newMedInstructions').value;
                
                if (!name || !dosage || times.length === 0) {
                    showNotification('Error', 'Please fill all required fields', 'warning');
                    return;
                }
                
                const newMedication = {
                    id: medicationData.length + 1,
                    name: name,
                    dosage: dosage,
                    dosageKannada: dosage,
                    times: times,
                    instructions: instructions,
                    instructionsKannada: instructions,
                    history: []
                };
                
                medicationData.push(newMedication);
                loadMedicationData();
                document.body.removeChild(modal);
                
                showNotification('Medication Added', `${name} has been added to your medications`, 'success');
                if (soundEnabled) playSound('successSound');
            });
        }

        // Show add appointment modal
        function showAddAppointmentModal() {
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const nextWeekStr = nextWeek.toISOString().split('T')[0];
            
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Book New Appointment</h3>
                        <p>Schedule a new medical appointment</p>
                    </div>
                    <div class="form-group">
                        <label for="newAppDoctor">Doctor Name</label>
                        <input type="text" id="newAppDoctor" placeholder="e.g., Dr. Smith">
                    </div>
                    <div class="form-group">
                        <label for="newAppSpecialization">Specialization</label>
                        <input type="text" id="newAppSpecialization" placeholder="e.g., Cardiologist">
                    </div>
                    <div class="form-group">
                        <label for="newAppDate">Date</label>
                        <input type="date" id="newAppDate" value="${nextWeekStr}" min="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <div class="form-group">
                        <label for="newAppTime">Time</label>
                        <select id="newAppTime">
                            <option value="09:00">09:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="14:00">02:00 PM</option>
                            <option value="15:00">03:00 PM</option>
                            <option value="16:00">04:00 PM</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newAppReason">Reason for Visit</label>
                        <textarea id="newAppReason" placeholder="Describe your symptoms or concerns"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button class="modal-cancel" id="cancelNewApp">Cancel</button>
                        <button class="modal-confirm" id="saveNewApp">Book Appointment</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('cancelNewApp').addEventListener('click', function() {
                document.body.removeChild(modal);
                showNotification('Cancelled', 'New appointment cancelled', 'info');
            });
            
            document.getElementById('saveNewApp').addEventListener('click', function() {
                const doctor = document.getElementById('newAppDoctor').value;
                const specialization = document.getElementById('newAppSpecialization').value;
                const date = document.getElementById('newAppDate').value;
                const time = document.getElementById('newAppTime').value;
                const reason = document.getElementById('newAppReason').value;
                
                if (!doctor || !specialization || !date || !reason.trim()) {
                    showNotification('Error', 'Please fill all required fields', 'warning');
                    return;
                }
                
                const formattedDate = new Date(date + 'T' + time).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const formattedTime = parseInt(time) <= 12 ? time + ' AM' : (parseInt(time) - 12) + ':00 PM';
                
                const newAppointment = {
                    id: appointmentData.length + 1,
                    doctor: doctor,
                    specialization: specialization,
                    date: `${formattedDate}, ${formattedTime}`,
                    status: 'upcoming',
                    details: {
                        dateTime: `${formattedDate}, ${formattedTime}`,
                        specialization: specialization,
                        location: "To be confirmed",
                        contact: "+91 98765 43210",
                        reason: reason
                    }
                };
                
                appointmentData.push(newAppointment);
                loadAppointmentData();
                document.body.removeChild(modal);
                
                showNotification('Appointment Booked', `Your appointment has been booked for ${formattedDate} at ${formattedTime}`, 'success');
                if (soundEnabled) playSound('successSound');
            });
        }
    </script>


    <script>
document.getElementById("loginButton").addEventListener("click", async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const response = await fetch("/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ email, password })
    });

    const result = await response.json();

    if (result.success) {
        document.getElementById("loginScreen").classList.remove("active");
        document.getElementById("mainApp").classList.add("active");
    } else {
        alert(result.message);
    }
});
</script>


<script>
document.getElementById("loginButton").addEventListener("click", async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const response = await fetch("/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ email, password })
    });

    const result = await response.json();

    if (result.success) {
        document.getElementById("loginScreen").classList.remove("active");
        document.getElementById("mainApp").classList.add("active");
    } else {
        alert(result.message);
    }
});
</script>


</body>
</html>